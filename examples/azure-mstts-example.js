/**
 * Azure MSTTS (Microsoft Text-to-Speech) Example
 *
 * This example demonstrates how to use MS-specific SSML tags with the Azure TTS engine.
 *
 * The speechmarkdown-js library (v2.1.0+) provides comprehensive Azure MSTTS support including:
 * - 33 express-as styles (emotional and scenario-specific)
 * - Intensity control via styledegree (0.01-2.0)
 * - Language switching
 * - HD voice support
 *
 * Two approaches are shown:
 * 1. Using Speech Markdown with microsoft-azure platform (automatic conversion via speechmarkdown-js)
 * 2. Using raw SSML with mstts tags (direct control with rawSSML option)
 *
 * The rawSSML option allows bypassing Speech Markdown conversion for:
 * - Advanced features not yet in Speech Markdown
 * - Direct SSML control
 * - SSML generated by other tools
 */

import { createTTSClient } from "../dist/esm/index.js";

async function demonstrateAzureMSTTS() {
  // Create Azure TTS client
  const tts = createTTSClient("azure", {
    subscriptionKey: process.env.AZURE_SUBSCRIPTION_KEY,
    region: process.env.AZURE_REGION || "eastus",
  });

  // Set the voice to a multilingual voice that supports mstts features
  tts.setVoice("XiaoXiaoMultilingual");

  console.log("=== Azure MSTTS Examples ===\n");
  console.log("Note: These examples use speechmarkdown-js (v2.1.0+) which provides");
  console.log("comprehensive Azure MSTTS support. Enable it with: SPEECHMARKDOWN_ENABLE=true\n");

  // Example 1: Using Speech Markdown with microsoft-azure platform
  // The speechmarkdown-js library automatically converts this to SSML with mstts namespace
  // This is the recommended approach for most use cases
  console.log("Example 1: Speech Markdown with microsoft-azure platform");
  console.log("Input: (This is exciting news!)[excited:\"1.5\"] The new features are here.");
  console.log("Note: speechmarkdown-js converts this to SSML with proper mstts namespace\n");

  try {
    await tts.speak(
      `(This is exciting news!)[excited:"1.5"] The new features are here.`,
      {
        useSpeechMarkdown: true,
        // The library will automatically use microsoft-azure platform for Azure engine
      }
    );
    console.log("✓ Speech Markdown synthesis completed\n");
  } catch (error) {
    console.error("✗ Speech Markdown synthesis failed:", error.message, "\n");
  }

  // Example 2: Using raw SSML with mstts tags
  // The rawSSML option bypasses Speech Markdown conversion and validation
  // This gives you full control over the SSML and allows using any mstts features
  // Use this when you need:
  // - Advanced features not yet in Speech Markdown
  // - Direct SSML control
  // - SSML generated by other tools
  console.log("Example 2: Raw SSML with mstts:express-as tag (using rawSSML option)");
  const rawSSML = `<speak xmlns:mstts="https://www.w3.org/2001/mstts">
    <mstts:express-as style="friendly" styledegree="0">
      A very sad day.
    </mstts:express-as>
  </speak>`;
  console.log("Input SSML:", rawSSML);
  console.log("Note: rawSSML option bypasses Speech Markdown conversion\n");

  try {
    await tts.speak(rawSSML, {
      rawSSML: true, // Skip Speech Markdown conversion and validation
    });
    console.log("✓ Raw SSML synthesis completed\n");
  } catch (error) {
    console.error("✗ Raw SSML synthesis failed:", error.message, "\n");
  }

  // Example 3: Multiple mstts styles
  console.log("Example 3: Multiple mstts:express-as styles");
  const multiStyleSSML = `<speak xmlns:mstts="https://www.w3.org/2001/mstts">
    <mstts:express-as style="cheerful">
      I'm so happy to see you!
    </mstts:express-as>
    <break time="500ms"/>
    <mstts:express-as style="sad">
      But I have some bad news.
    </mstts:express-as>
    <break time="500ms"/>
    <mstts:express-as style="angry">
      This is completely unacceptable!
    </mstts:express-as>
  </speak>`;
  console.log("Input SSML with multiple styles");
  console.log("");

  try {
    await tts.speak(multiStyleSSML, {
      rawSSML: true,
    });
    console.log("✓ Multi-style synthesis completed\n");
  } catch (error) {
    console.error("✗ Multi-style synthesis failed:", error.message, "\n");
  }

  // Example 4: Combining mstts with standard SSML
  console.log("Example 4: Combining mstts with standard SSML elements");
  const combinedSSML = `<speak xmlns:mstts="https://www.w3.org/2001/mstts">
    <mstts:express-as style="excited">
      <prosody rate="fast" pitch="high">
        This is amazing!
      </prosody>
    </mstts:express-as>
    <break time="1s"/>
    <mstts:express-as style="calm">
      <prosody rate="slow" pitch="low">
        Let me explain this carefully.
      </prosody>
    </mstts:express-as>
  </speak>`;
  console.log("Input SSML combining mstts and prosody");
  console.log("");

  try {
    await tts.speak(combinedSSML, {
      rawSSML: true,
    });
    console.log("✓ Combined SSML synthesis completed\n");
  } catch (error) {
    console.error("✗ Combined SSML synthesis failed:", error.message, "\n");
  }

  console.log("=== Using speechmarkdown-js Directly ===");
  console.log("For advanced features, you can use speechmarkdown-js directly:");
  console.log("");

  // Example showing direct speechmarkdown-js usage
  try {
    const { SpeechMarkdown } = await import("speechmarkdown-js");

    const advancedMarkdown = `
      (This is exciting!)[excited:"1.8"]
      [500ms]
      (Now let me explain)[calm:"0.5"]
    `;

    console.log("Input Markdown:", advancedMarkdown);
    const advancedSSML = await SpeechMarkdown.toSSML(advancedMarkdown, "microsoft-azure");
    console.log("Generated SSML:", advancedSSML);
    console.log("");

    // Pass the generated SSML with rawSSML option
    await tts.speak(advancedSSML, { rawSSML: true });
    console.log("✓ Advanced Speech Markdown synthesis completed\n");
  } catch (error) {
    console.log("Note: speechmarkdown-js direct usage requires SPEECHMARKDOWN_ENABLE=true\n");
  }

  console.log("=== Available mstts:express-as Styles ===");
  console.log("Emotional styles: excited, disappointed, friendly, cheerful, sad, angry");
  console.log("Scenario styles: newscaster, customerservice, chat, etc.");
  console.log("Use styledegree (0-2) to control intensity");
  console.log("");
  console.log("For complete list of 33 styles, see:");
  console.log("https://github.com/speechmarkdown/speechmarkdown-js/blob/master/docs/platforms/azure.md");
}

// Run the example
demonstrateAzureMSTTS().catch(console.error);

